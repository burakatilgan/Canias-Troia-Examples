-- DEVT01 KISA YOL -- 

-- SEÇİLEN TABLONUN UNİQ İNDEXLERİNE GÖRE SELECT SORGUSU HAZIRLAMA -- 

OBJECT: 
 STRING SCRIPTTEXT;

SELECT * 
	FROM SYSFIELDS 
	WHERE CLIENT = SYS_CLIENT 
		AND TABLEN = TEMPTABLES_TABLEN 
		AND FKEY = 1 
	ORDERBY FNUMBR 
	INTO TMPTABLES;

SELECT * 
	FROM SYSMODFIELDS 
	WHERE CLIENT = SYS_CLIENT 
		AND TABLEN = TEMPTABLES_TABLEN 
		AND FKEY = 1 
	ORDERBY FNUMBR 
	INTO TMPTABLES1;

MERGETABLE TMPTABLES1 INTO TMPTABLES;
SCRIPTTEXT = 'SELECT * FROM ' + TEMPTABLES_TABLEN + ' WHERE ';

LOOP AT TMPTABLES 
BEGIN

	IF TMPTABLES_FIELDN == 'CLIENT' THEN
		SCRIPTTEXT = SCRIPTTEXT + ' ' + TEMPTABLES_TABLEN + '.' + TMPTABLES_FIELDN + ' = SYS_' + TMPTABLES_FIELDN;
	ENDIF;


	IF TMPTABLES_FIELDN == 'VALIDFROM' THEN
		SCRIPTTEXT = SCRIPTTEXT + ' ' + TEMPTABLES_TABLEN + '.' + TMPTABLES_FIELDN + ' <= SYS_CURRENTDATE';
	ENDIF;


	IF TMPTABLES_FIELDN == 'VALIDUNTIL' THEN
		SCRIPTTEXT = SCRIPTTEXT + ' ' + TEMPTABLES_TABLEN + '.' + TMPTABLES_FIELDN + ' >= SYS_CURRENTDATE';
	ENDIF;


	IF TMPTABLES_FIELDN == 'LANGU' THEN
		SCRIPTTEXT = SCRIPTTEXT + ' ' + TEMPTABLES_TABLEN + '.' + TMPTABLES_FIELDN + ' = SYS_LANGU';
	ENDIF;


	IF TMPTABLES_FIELDN != 'CLIENT' 
			&& TMPTABLES_FIELDN != 'VALIDFROM' 
			&& TMPTABLES_FIELDN != 'VALIDUNTIL' 
			&& TMPTABLES_FIELDN != 'LANGU' THEN
		SCRIPTTEXT = SCRIPTTEXT + ' ' + TEMPTABLES_TABLEN + '.' + TMPTABLES_FIELDN + ' = #TMPTABLE#_' + TMPTABLES_FIELDN;
	ENDIF;


	IF TMPTABLES_ACTIVEROW != TMPTABLES_ROWCOUNT THEN
		SCRIPTTEXT = SCRIPTTEXT + ' AND ';
	ELSE
		SCRIPTTEXT = SCRIPTTEXT + TOCHAR(59);
	ENDIF;

ENDLOOP;

SETCLIPBOARD FROM SCRIPTTEXT;
