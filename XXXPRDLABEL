-- XXXPRD ETİTEK ÇIKTISI --
OBJECT: 
 NUMRANGE NUMRANGEREC,
 BAS004 BAS004REC,
 DECIMAL NFACTORRESULT,
 DECIMAL QTY,
 DECIMAL QTYSK,
 DECIMAL QTYIU,
 DECIMAL QTYSON,
 STRING BR,
 STRING ETIKETNO,
 STRING MTEXT,
 STRING XXXQTY,
 STRING XXXQTY2,
 STRING BARKODNOTXT,
 STRING BARCODEPATH,
 STRING FORMAT1,
 STRING FORMAT2,
 STRING CUSTORDNO,
 STRING CUSTNO,
 STRING CUSTMAT;

FORMAT1 = '-FL#,###,##0';
FORMAT2 = '-FL#,###,##0.0';
QTY = MIKTAR;
SELECT SKUNIT, IUNIT 
	FROM IASMATBASIC 
	WHERE CLIENT = SYS_CLIENT 
		AND COMPANY = OPRLIST_COMPANY 
		AND MATERIAL = OPRLIST_MATERIAL 
		AND VALIDFROM <= SYS_CURRENTDATE 
		AND VALIDUNTIL >= SYS_CURRENTDATE 
	INTO MATTBL;

NFACTORRESULT = BAS004REC.GETMATFACTOR(OPRLIST_COMPANY, OPRLIST_MATERIAL, SYS_CURRENTDATE, BIRIM, MATTBL_SKUNIT, '', 1);
QTYSK = NFACTORRESULT * QTY;
XXXQTY = NUMPICTFORMAT(QTYSK, FORMAT1);
XXXQTY = XXXQTY + ' ' + MATTBL_SKUNIT;
NFACTORRESULT = BAS004REC.GETMATFACTOR(OPRLIST_COMPANY, OPRLIST_MATERIAL, SYS_CURRENTDATE, BIRIM, MATTBL_IUNIT, '', 1);
QTYIU = NFACTORRESULT * QTY;
XXXQTY2 = NUMPICTFORMAT(QTYIU, FORMAT2);
XXXQTY2 = XXXQTY2 + ' ' + MATTBL_IUNIT;

SELECT LTEXT 
	FROM IASMATX 
	WHERE  CLIENT= SYS_CLIENT 
		AND COMPANY = OPRLIST_COMPANY 
		AND MATERIAL = OPRLIST_MATERIAL 
		AND PLANT=OPRLIST_PLANT 
		AND TEXTTYPE='M' 
		AND LANGU='T' 
	INTO TMPX;


IF SELECTED  THEN
	MOVE TMPX_LTEXT TO MTEXT ;
	CUSTO = OPRLIST_NAME1;
	MOVE OPRLIST_CUSTORDERNUM TO CUSTORDNO;
	SELECT XXXKOD 
		FROM IASMATBASIC 
		WHERE CLIENT = SYS_CLIENT 
			AND MATERIAL = OPRLIST_MATERIAL 
			AND COMPANY = SCOMP 
		INTO TPMXXXKOD;

	SELECT CMATERIAL
		FROM IASMATCUSTOMERS 
		WHERE COMPANY = '02' 
			AND CLIENT = '00' 
			AND CUSTOMER = OPRLIST_CUSTOMER 
			AND XXXKOD = TPMXXXKOD_XXXKOD 
		INTO TPMCUSTMAT;
    CUSTMATERIAL = TPMCUSTMAT_CMATERIAL;
ENDIF;

SELECT IASINV002HEAD.SEPERATOR 
	FROM IASINV002HEAD 
	WHERE  IASINV002HEAD.CLIENT = SYS_CLIENT 
		AND  IASINV002HEAD.COMPANY = OPRLIST_COMPANY 
		AND  IASINV002HEAD.BARCODETYPE = 1 
	INTO TMPIASINV002;

SELECT PRDORDER, SUM(OUTPUT) AS TOTAL 
	FROM IASPRDCONF 
	WHERE CLIENT = SYS_CLIENT 
		AND COMPANY = SCOM 
		AND PRDORDER = OPRLIST_PRDORDER 
		AND POTYPE = OPRLIST_POTYPE 
		AND OPERATION = OPRLIST_OPERATION 
	GROUPBY PRDORDER 
	INTO TPMTOTAL;


IF QTY > TPMTOTAL_TOTAL THEN
	MESSAGE XXX W15;
	RETURN 0;
ELSE

	WHILE SYC > 0 
	BEGIN
		ETIKETNO = NUMRANGEREC.NEWNUMBERS(OPRLIST_COMPANY, 'ETIKET', SYS_CURRENTDATE);
		BARKODNOTXT = OPRLIST_MATERIAL + TMPIASINV002_SEPERATOR + OPRLIST_BATCHNUM + TMPIASINV002_SEPERATOR + QTYSK + TMPIASINV002_SEPERATOR + MATTBL_SKUNIT + TMPIASINV002_SEPERATOR + ETIKETNO;
		BARCODEPATH = 'TempFiles\\' + OPRLIST_MATERIAL + ETIKETNO + '.jpg';
		CREATE2DBARCODE AS QRCODE FROM BARKODNOTXT INTO BARCODEPATH;
		WRITE SECTION SECTION00;

		IF OPRLIST_NAME1 != '' THEN
                        WRITE SECTION SECTION1;
                    ENDIF;

		SYC = SYC - 1;
	ENDWHILE;

ENDIF;
